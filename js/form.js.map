{"version":3,"file":"form.js","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://appointments/./src/form.js"],"sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\n(function () {\n  \"use strict\";\n\n  window.addEventListener('DOMContentLoaded', formReady);\n\n  function formReady() {\n    var gdpr = document.getElementById('appt_gdpr_id');\n\n    if (gdpr !== null) {\n      gdpr.addEventListener('change', gdprCheck);\n      gdprCheck.apply(gdpr);\n    }\n\n    var f = document.getElementById(\"srgdev-ncfp_frm\");\n    f.addEventListener(\"submit\", formSubmit); // chrome bfcache\n\n    setTimeout(function () {\n      f.autocomplete = \"on\";\n    }, 1000);\n    makeDpu(f.getAttribute(\"data-pps\"));\n    document.getElementById(\"srgdev-ncfp_sel-dummy\").addEventListener(\"click\", selClick);\n    setTimeout(function () {\n      var b = document.getElementById(\"srgdev-ncfp_fbtn\");\n      var txt; // translations are done on the backend (bug???)\n\n      if (b.hasAttribute(\"data-tr-ses-to\")) {\n        txt = b.getAttribute('data-tr-ses-to');\n      } else {\n        // Back-up ????\n        txt = 'Session Timeout. Reload.';\n      }\n\n      b.disabled = true;\n      b.textContent = txt;\n    }, 900000);\n  }\n\n  function gdprCheck() {\n    var btn = document.getElementById(\"srgdev-ncfp_fbtn\");\n\n    if (this.checked) {\n      if (btn.hasAttribute('shade')) btn.removeAttribute('shade');\n    } else {\n      if (!btn.hasAttribute('shade')) btn.setAttribute('shade', \"1\");\n    }\n\n    if (this.hasAttribute(\"err\")) {\n      this.removeAttribute(\"err\");\n    }\n\n    if (this.hasAttribute(\"required\")) {\n      this.removeAttribute(\"required\");\n    }\n  }\n\n  function clearFormErr() {\n    this.setCustomValidity('');\n\n    if (this.getAttribute('err')) {\n      this.removeAttribute('err');\n      this.removeEventListener(\"focus\", clearFormErr, false);\n    } else {\n      this.removeEventListener(\"input\", clearFormErr, false);\n    }\n  }\n\n  function formSubmit(e) {\n    var lee = 0;\n    var el = document.getElementById(\"srgdev-ncfp_fbtn\");\n\n    if (el.disabled === true) {\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n    }\n\n    el = document.getElementById(\"srgdev-ncfp_sel-hidden\");\n    var sdx = el.selectedIndex;\n    var tzi;\n\n    if (sdx === -1 || el.value === \"\") {\n      el = document.getElementById(\"srgdev-ncfp_sel-dummy\");\n      el.setAttribute('err', 'err');\n      el.addEventListener(\"focus\", clearFormErr, false);\n      lee = 1;\n    } else {\n      tzi = el.dataRef[sdx].tzi;\n    }\n\n    el = document.getElementById(\"srgdev-ncfp_talk_type\");\n\n    if (el !== null) {\n      sdx = el.selectedIndex;\n\n      if (sdx !== 1 && sdx !== 2) {\n        el.setAttribute('err', 'err');\n        el.addEventListener(\"focus\", clearFormErr, false);\n        lee = 1;\n      }\n    }\n\n    el = document.getElementById(\"srgdev-ncfp_fname\");\n\n    if (el.value.length < 3) {\n      el.setCustomValidity(t('appointments', 'Name is required.'));\n      el.addEventListener(\"input\", clearFormErr, false);\n      lee = 1;\n    }\n\n    el = document.getElementById(\"srgdev-ncfp_femail\");\n\n    if (el.value.length < 5 || el.value.indexOf(\"@\") === -1 || el.value.indexOf(\"@\") > el.value.lastIndexOf(\".\")) {\n      el.setCustomValidity(t('appointments', 'Email is required.'));\n      el.addEventListener(\"input\", clearFormErr, false);\n      lee = 1;\n    } // Phone field is optional\n    // match [0-9], '.()-+,/' and ' ' (space) at least 9 digits\n\n\n    el = document.getElementById(\"srgdev-ncfp_fphone\");\n\n    if (el !== null && (el.value === '' || el.value.length < 9 || /^[0-9 .()\\-+,/]*$/.test(el.value) === false)) {\n      el.setCustomValidity(t('appointments', 'Phone number is required.'));\n      el.addEventListener(\"input\", clearFormErr, false);\n      lee = 1;\n    } //Check for custom inputs\n\n\n    var elms = document.getElementById('srgdev-ncfp-main-inputs').children;\n\n    for (var i = 0, elm, l = elms.length; i < l; i++) {\n      elm = elms[i];\n\n      if (elm.hasAttribute('data-more')) {\n        if (elm.tagName === 'INPUT' || elm.tagName === 'TEXTAREA') {\n          var cv = elm.value.trim();\n\n          if (elm.getAttribute('data-more') === 'r1' && cv === '') {\n            elm.setCustomValidity(t('appointments', 'Required.'));\n            elm.addEventListener(\"input\", clearFormErr, false);\n            lee = 1;\n          } else if (elm.hasAttribute('type') && elm.getAttribute('type') === 'number' && isNaN(cv)) {\n            elm.setCustomValidity(t('appointments', 'Number required.'));\n            elm.addEventListener(\"input\", clearFormErr, false);\n            lee = 1;\n          }\n        }\n      }\n    }\n\n    el = document.getElementById('appt_gdpr_id');\n\n    if (el !== null && el.checked === false) {\n      el.setAttribute(\"err\", \"err\");\n      el.setAttribute(\"required\", \"1\");\n      lee = 1;\n    }\n\n    if (lee !== 0) {\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n    }\n\n    document.getElementById(\"srgdev-ncfp_fbtn-spinner\").style.display = \"inline-block\";\n    el = document.createElement(\"input\");\n    el.type = \"hidden\";\n    el.name = \"tzi\";\n    el.value = tzi;\n    this.appendChild(el);\n  }\n\n  function selClick(e) {\n    var elm = document.getElementById(\"srgdev-dpu_main-cont\");\n\n    if (elm.getAttribute(\"data-open\") === null) {\n      elm.setAttribute(\"data-open\", '');\n    } else {\n      elm.removeAttribute(\"data-open\");\n    }\n\n    e.preventDefault();\n    return false;\n  }\n\n  function dateClick(e) {\n    var n = this.id.slice(13);\n    var c = this.parentElement.curActive;\n    if (c === n) return;\n    document.getElementById('srgdev-dpu_dc' + c).removeAttribute('data-active');\n    document.getElementById('srgdev-dpu_dc' + n).setAttribute('data-active', '');\n    this.parentElement.curActive = n;\n    if (n.slice(-1) === 'e') n = 'e';\n    if (c.slice(-1) === 'e') c = 'e';\n    document.getElementById('srgdev-dpu_tc' + c).removeAttribute('data-active');\n    document.getElementById('srgdev-dpu_tc' + n).setAttribute('data-active', '');\n    e.stopPropagation();\n  }\n\n  function timeClick(e) {\n    var t = e.target;\n\n    if (t.parentElement.dpuClickID !== undefined) {\n      t = t.parentElement;\n    }\n\n    if (t.dpuClickID !== undefined) {\n      document.getElementById('srgdev-ncfp_sel-dummy').value = t.parentElement.getAttribute('data-dm') + ' - ' + t.timeAt;\n      var elm = document.getElementById('srgdev-ncfp_sel-hidden');\n      elm.selectedIndex = t.dpuClickID;\n      elm.value = elm.dataRef[t.dpuClickID].d;\n      var dur = elm.dataRef[t.dpuClickID].dur;\n      elm = document.getElementById('srgdev-ncfp_dur-cont');\n      var hrStr = elm.getAttribute(\"data-tr-hr\");\n      var mnStr = elm.getAttribute(\"data-tr-mn\");\n\n      var makeHrMin = function makeHrMin(v) {\n        var hrMinStr = \"\";\n        var hours = v / 60 | 0;\n\n        if (hours > 0) {\n          hrMinStr += hours + hrStr + \" \";\n        }\n\n        return hrMinStr + (v - hours * 60) + mnStr;\n      };\n\n      if (dur === null || dur.length === 1) {\n        elm.style.display = 'none';\n      } else {\n        var opts = elm.lastElementChild.children;\n        var tr = window.t('appointments', 'Minutes');\n        opts[0].textContent = makeHrMin(dur[0]);\n\n        for (var o, i = 1, hours = 0, minutes = 0, l = Math.max(opts.length, dur.length); i < l; i++) {\n          if (i >= opts.length) {\n            // create\n            o = document.createElement('option');\n            o.className = 'srgdev-ncfp-form-option';\n            o.appendChild(document.createTextNode(''));\n            elm.lastElementChild.appendChild(o);\n          } else {\n            o = opts[i];\n\n            if (i >= dur.length) {\n              o.style.display = 'none';\n              continue;\n            }\n          }\n\n          o.style.display = 'block';\n          o.value = i;\n          o.textContent = makeHrMin(dur[i]);\n        }\n\n        elm.style.display = 'block';\n      }\n\n      elm.lastElementChild.value = 0;\n      document.getElementById(\"srgdev-dpu_main-cont\").removeAttribute(\"data-open\");\n    }\n  }\n\n  function prevNextDPU(e) {\n    var p; // e.target===undefined when we do initial \"scroll\" @see makeDpu()\n\n    if (e.target !== undefined) {\n      p = e.target.parentElement;\n\n      if (e.target.id === \"srgdev-dpu_bf-back\") {\n        if (p.curDP > 0) p.curDP--;\n      } else {\n        if (p.curDP < p.maxDP) p.curDP++;\n\n        if (p.curDP === p.maxDP) {\n          e.target.setAttribute('disabled', '');\n        } else {\n          e.target.removeAttribute('disabled');\n        }\n      }\n    } else {\n      p = e;\n    }\n\n    if (p.curDP === 0) {\n      p.firstElementChild.setAttribute('disabled', '');\n    } else {\n      p.firstElementChild.removeAttribute('disabled');\n    }\n\n    if (p.curDP === p.maxDP) {\n      p.lastElementChild.setAttribute('disabled', '');\n    } else {\n      p.lastElementChild.removeAttribute('disabled');\n    } // TODO: find first not empty and select it ?\n\n\n    document.getElementById(\"srgdev-dpu_main-date\").style.left = \"-\" + p.curDP * 5 * 4.6 + \"em\";\n  }\n\n  function addSwipe(cont, bfc) {\n    cont.touchInfo = {\n      x: 0,\n      y: 0,\n      id: -1\n    };\n    cont.bfNav = bfc;\n    cont.addEventListener(\"touchstart\", swipeStart);\n    cont.addEventListener(\"touchend\", swipeEnd);\n  }\n  /** @param {TouchEvent} e */\n\n\n  function swipeStart(e) {\n    if (e.changedTouches !== undefined && e.changedTouches.length > 0) {\n      var cc = e.changedTouches[0];\n      var ti = this.touchInfo;\n      ti.x = cc.clientX;\n      ti.y = cc.clientY;\n      ti.id = cc.identifier;\n    }\n  }\n  /** @param {TouchEvent} e */\n\n\n  function swipeEnd(e) {\n    if (e.changedTouches !== undefined && e.changedTouches.length > 0) {\n      var cc = e.changedTouches[0];\n      var ti = this.touchInfo;\n\n      if (cc.identifier === ti.id) {\n        var dx = cc.clientX - ti.x | 0;\n        var dy = cc.clientY - ti.y | 0;\n\n        var _t = dx >> 31;\n\n        var dx_abc = dx + _t ^ _t;\n        _t = dy >> 31;\n\n        if (dx_abc > (dy + _t ^ _t) && dx_abc > 50) {\n          if (dx < 0) {\n            // swipe left - push next\n            this.bfNav.lastElementChild.click();\n          } else {\n            // swipe right - push prev\n            this.bfNav.firstElementChild.click();\n          }\n        }\n      }\n\n      ti.id = -1;\n    }\n  }\n\n  function makeDpu(pps) {\n    var PPS_NWEEKS = \"nbrWeeks\";\n    var PPS_EMPTY = \"showEmpty\";\n    var PPS_FNED = \"startFNED\";\n    var PPS_WEEKEND = \"showWeekends\";\n    var PPS_SHOWTZ = \"showTZ\";\n    var PPS_TIME2 = \"time2Cols\";\n    var PPS_END_TIME = \"endTime\";\n    var pso = {};\n    var ta = pps.split('.');\n\n    for (var a, _l = ta.length, i = 0; i < _l; i++) {\n      a = ta[i].split(':');\n      pso[a[0]] = +a[1];\n    }\n\n    var min_days = 7 * pso[PPS_NWEEKS];\n    var s = document.getElementById('srgdev-ncfp_sel-hidden');\n\n    if (s.getAttribute(\"data-state\") !== '2') {\n      console.log(\"data-state: \", s.getAttribute(\"data-state\"));\n      return;\n    } // There is a problem with js translations without Vue, so just get it from PHP for now\n\n\n    var dpuTrHdr = s.getAttribute(\"data-hdr\");\n    var dpuTrBack = s.getAttribute(\"data-tr-back\");\n    var dpuTrNext = s.getAttribute(\"data-tr-next\");\n    var dpuTrNA = s.getAttribute(\"data-tr-not-available\");\n    var mn;\n    var dn;\n\n    if (window.monthNames !== undefined) {\n      mn = window.monthNames;\n    } else {\n      mn = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n    }\n\n    if (window.dayNames !== undefined) {\n      dn = window.dayNames;\n    } else {\n      dn = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n    }\n\n    var has_intl = window.Intl && _typeof(window.Intl) === \"object\";\n    var lang = document.documentElement.lang;\n    var tf;\n\n    if (has_intl) {\n      var f = new Intl.DateTimeFormat([lang], {\n        hour: \"numeric\",\n        minute: \"2-digit\"\n      });\n      tf = f.format;\n    } else {\n      tf = function tf(d) {\n        return d.toLocaleTimeString();\n      };\n    }\n\n    var df;\n\n    if (has_intl) {\n      var _f = new Intl.DateTimeFormat([lang], {\n        month: \"long\"\n      });\n\n      df = _f.format;\n    } else {\n      df = function df(d) {\n        return mn[d.getMonth()];\n      };\n    }\n\n    var wf;\n\n    if (has_intl) {\n      var _f2 = new Intl.DateTimeFormat([lang], {\n        weekday: \"short\"\n      });\n\n      wf = _f2.format;\n    } else {\n      wf = function wf(d) {\n        return dn[d.getDay()];\n      };\n    }\n\n    var wft;\n\n    if (has_intl) {\n      var _f3 = new Intl.DateTimeFormat([lang], {\n        weekday: \"short\",\n        month: \"long\",\n        day: \"2-digit\"\n      });\n\n      wft = _f3.format;\n    } else {\n      wft = function wft(d) {\n        return d.toDateString();\n      };\n    }\n\n    var wff;\n\n    if (has_intl) {\n      var _f4 = new Intl.DateTimeFormat([lang], {\n        weekday: \"long\",\n        month: \"long\",\n        day: \"numeric\",\n        year: \"numeric\"\n      });\n\n      wff = _f4.format;\n    } else {\n      wff = function wff(d) {\n        return d.toLocaleDateString();\n      };\n    }\n\n    var dta = [];\n    var tzn = undefined;\n\n    if (has_intl) {\n      try {\n        tzn = Intl.DateTimeFormat().resolvedOptions().timeZone;\n      } catch (e) {\n        console.log(\"no Intl timeZone \", e);\n      }\n\n      if (typeof tzn !== \"string\") tzn = undefined;\n    }\n\n    for (var md = new Date(), tzo, tzi, _t2, tStr, atStr, sp, sp2, dur, dur_idx, ts, endTime = pso[PPS_END_TIME], ia = s.getAttribute(\"data-info\").split(','), _l2 = ia.length, _i = 0, ds; _i < _l2; _i++) {\n      //TODO: remove 'U' from ds ????\n      ds = ia[_i];\n      sp = ds.indexOf(\":\", 8);\n      md.setTime(+ds.substr(1, sp - 1) * 1000);\n      tzo = md.getTimezoneOffset(); // t='U' in simple and external modes\n      // t='T' in template mode\n\n      _t2 = ds.charAt(0);\n      tStr = atStr = tf(md);\n      ts = md.getTime();\n      dur = null;\n\n      if (endTime === 1 || _t2 === 'T') {\n        sp2 = sp + 1; // sp must be the pos of the last used ':'\n\n        sp = ds.indexOf(\":\", sp2);\n\n        if (_t2 === \"T\") {\n          dur = ds.substr(sp2, sp - sp2).split(';').map(function (n) {\n            return n | 0;\n          });\n\n          if (endTime === 1 && dur.length < 2) {\n            md.setTime(ts + dur[0] * 60000);\n            tStr += ' - ' + tf(md);\n          }\n        } else {\n          sp2 = +ds.substr(sp2, sp - sp2) * 1000;\n          md.setTime(sp2);\n          tStr += ' - ' + tf(md);\n        }\n      }\n\n      if (tzn !== undefined) {\n        tzi = _t2 + tzn;\n      } else {\n        // fallback, needs to be done for every date because of daylight savings\n        var ao = Math.abs(tzo);\n        var h = Math.floor(ao / 60);\n        var m = ao - h * 60; // offset sign is reversed https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTimezoneOffset\n\n        tzi = _t2 + (tzo > 0 ? '-' : '+') + (h < 10 ? '0' + h : h) + (m < 10 ? '0' + m : m);\n      }\n\n      sp++;\n      sp2 = ds.indexOf(\":\", sp);\n      dta[_i] = {\n        rts: ts,\n        d: ds.substr(sp, sp2 - sp),\n        t: ds.substr(sp2 + 2),\n        // +2 is for \":_\"\n        dur: dur,\n        tzi: tzi,\n        time: tStr,\n        timeAt: atStr\n      };\n    }\n\n    dta.sort(function (a, b) {\n      return a.rts > b.rts ? 1 : -1;\n    });\n    dta.push({\n      rts: 0,\n      d: \"\",\n      t: \"\",\n      tzi: \"\",\n      time: \"\"\n    }); //last option to finalize the loop\n    // console.log(dta)\n\n    s.dataRef = dta;\n    var l = dta.length;\n    var cont = document.createElement('div');\n    cont.id = \"srgdev-dpu_main-cont\";\n    cont.className = \"srgdev-dpu-bkr-cls\";\n    var lcd = document.createElement('div');\n    lcd.id = \"srgdev-dpu_main-header\";\n    lcd.appendChild(document.createTextNode(dpuTrHdr));\n    var lcdBF = document.createElement('div');\n    lcdBF.id = \"srgdev-dpu_main-hdr-icon\";\n    lcdBF.className = \"icon-close\";\n    lcdBF.addEventListener('click', function () {\n      document.getElementById(\"srgdev-dpu_main-cont\").removeAttribute(\"data-open\");\n    });\n    lcd.appendChild(lcdBF);\n    cont.appendChild(lcd);\n    lcdBF = document.createElement('div');\n    lcdBF.maxDP = 0;\n    lcdBF.curDP = 0;\n    lcdBF.id = \"srgdev-dpu_bf-cont\";\n    lcdBF.appendChild(document.createElement(\"span\"));\n    lcdBF.appendChild(document.createElement(\"span\"));\n    lcdBF.firstElementChild.id = \"srgdev-dpu_bf-back\";\n    lcdBF.firstElementChild.appendChild(document.createTextNode(dpuTrBack));\n    lcdBF.firstElementChild.addEventListener(\"click\", prevNextDPU);\n    lcdBF.firstElementChild.setAttribute('disabled', '');\n    lcdBF.lastElementChild.id = \"srgdev-dpu_bf-next\";\n    lcdBF.lastElementChild.appendChild(document.createTextNode(dpuTrNext));\n    lcdBF.lastElementChild.addEventListener(\"click\", prevNextDPU);\n    cont.appendChild(lcdBF);\n    lcd = document.createElement('div');\n    lcd.id = \"srgdev-dpu_main-date\";\n    lcd.className = \"srgdev-dpu-bkr-cls\";\n    lcd.style.left = \"0em\";\n    addSwipe(lcd, lcdBF);\n    cont.appendChild(lcd);\n    var lcTime = document.createElement('div');\n    lcTime.id = \"srgdev-dpu_main-time\";\n    cont.appendChild(lcTime);\n    var lcc = 0;\n    var rccN = 5;\n    var d = new Date();\n    var lastUD = -1;\n    var an = -1;\n    var do_break = false;\n\n    var makeDateCont = function makeDateCont(d, is_empty) {\n      var e1 = document.createElement(\"div\");\n      e1.id = \"srgdev-dpu_dc\" + lcc + (is_empty ? \"e\" : \"\");\n      e1.className = 'srgdev-dpu-date-cont' + (is_empty ? \" srgdev-dpu-dc-empty\" : \"\");\n      var e2 = document.createElement('span');\n      e2.className = d.getDay() !== 0 ? 'srgdev-dpu-date-wd' : 'srgdev-dpu-date-wd srgdev-dpu-date-wd-sunday';\n      e2.appendChild(document.createTextNode(wf(d)));\n      e1.appendChild(e2);\n      e2 = document.createElement('span');\n      e2.className = 'srgdev-dpu-date-dn';\n      e2.appendChild(document.createTextNode(d.getDate()));\n      e1.appendChild(e2);\n      e2 = document.createElement('span');\n      e2.className = 'srgdev-dpu-date-md';\n      e2.appendChild(document.createTextNode(df(d)));\n      e1.appendChild(e2);\n      e1.addEventListener('click', dateClick);\n\n      if (lcc === rccN) {\n        rccN += 5;\n        lcdBF.maxDP++;\n        if (lcc > min_days) do_break = true;\n      }\n\n      ++lcc;\n      return e1;\n    };\n\n    var td = new Date();\n    td.setSeconds(1);\n    td.setMinutes(0);\n    td.setHours(0);\n\n    if (pso[PPS_EMPTY] === 1 && pso[PPS_FNED] === 0) {\n      // Need to prepend empty days so the week start on Monday\n      var _ts = dta[0].rts;\n      d.setTime(_ts);\n      d.setSeconds(1);\n      d.setMinutes(0);\n      d.setHours(0);\n      var fd = d.getDay();\n\n      if (fd > 0 && fd < 6) {\n        td.setTime(d.getTime() - 86400000 * (fd - 1));\n      }\n    }\n\n    var tu_class; // Time columns\n\n    if (pso[PPS_TIME2] === 0 || pso[PPS_END_TIME] === 1) {\n      tu_class = 'srgdev-dpu-time-unit' + (pso[PPS_END_TIME] === 1 ? \"_tn\" : \"\");\n    } else {\n      tu_class = 'srgdev-dpu-time-unit2';\n    }\n\n    var getTzName;\n\n    if (pso[PPS_SHOWTZ] === 1 && has_intl) {\n      // getTzName=\n      getTzName = function getTzName(d) {\n        var short = d.toLocaleDateString([lang]);\n        var full = d.toLocaleDateString([lang], {\n          timeZoneName: 'long'\n        }); // Trying to remove date from the string in a locale-agnostic way\n\n        var shortIndex = full.indexOf(short);\n\n        if (shortIndex >= 0) {\n          var trimmed = full.substring(0, shortIndex) + full.substring(shortIndex + short.length); // by this time `trimmed` should be the timezone's name with some punctuation -\n          // trim it from both sides\n\n          return trimmed.replace(/^[\\s,.\\-:;]+|[\\s,.\\-:;]+$/g, '');\n        } else {\n          return full;\n        }\n      };\n    } else {\n      getTzName = function getTzName() {\n        return '';\n      };\n    }\n\n    for (var tl, _ts2, _ti, ets, tts, _te, pe, elt, dto, _tzn, _i2 = 0; _i2 < l; _i2++) {\n      dto = dta[_i2];\n      _ts2 = dto.rts;\n      if (_ts2 === 0) break;\n      d.setTime(_ts2);\n      var ud = d.getDate();\n\n      if (lastUD !== ud) {\n        // if(do_break) break\n        // Show \"empty\" days ...\n        tts = td.getTime();\n        td.setTime(d.getTime());\n        td.setSeconds(1);\n        td.setMinutes(0);\n        td.setHours(0);\n        ets = td.getTime();\n\n        if (pso[PPS_EMPTY] === 1) {\n          while (tts < ets) {\n            td.setTime(tts); // Deal with weekends\n\n            if (pso[PPS_WEEKEND] === 0) {\n              // only show weekdays\n              _ti = td.getDay();\n            } else {\n              // show all days\n              _ti = 1;\n            }\n\n            if (_ti !== 0 && _ti !== 6) {\n              lcd.appendChild(makeDateCont(td, true));\n              if (do_break) break;\n            }\n\n            tts += 86400000;\n          }\n        }\n\n        if (do_break) {\n          d = td;\n          break;\n        }\n\n        td.setTime(tts + 86400000);\n        _te = makeDateCont(d, false);\n\n        if (an === -1) {\n          an = lcc - 1;\n\n          _te.setAttribute('data-active', '');\n        }\n\n        lcd.appendChild(_te);\n        _te = document.createElement('div');\n        _te.id = \"srgdev-dpu_tc\" + (lcc - 1);\n        _te.className = 'srgdev-dpu-time-cont';\n        pe = document.createElement('div');\n        pe.className = \"srgdev-dpu-tc-full-date\";\n        pe.appendChild(document.createTextNode(wff(d))); // time zone\n\n        _tzn = getTzName(d);\n\n        if (_tzn !== '') {\n          elt = document.createElement('div');\n          elt.className = \"srgdev-dpu-tc-timezone\";\n          elt.appendChild(document.createTextNode(_tzn));\n          pe.appendChild(elt);\n        }\n\n        _te.appendChild(pe);\n\n        pe = document.createElement('div');\n        pe.setAttribute('data-dm', wft(d));\n        pe.className = \"srgdev-dpu-tc-tu-wrap\";\n\n        _te.appendChild(pe);\n\n        lcTime.appendChild(_te);\n        lastUD = ud;\n      }\n\n      _te = document.createElement(\"span\");\n      _te.className = tu_class;\n      _te.dpuClickID = _i2;\n      _te.timeAt = dto.timeAt; // te.appendChild(document.createTextNode(tf(d)))\n\n      _te.appendChild(document.createTextNode(dto.time));\n\n      if (dto.t !== \"\") {\n        tl = document.createElement(\"span\");\n        tl.className = \"srgdev-dpu-appt-title\";\n        tl.appendChild(document.createTextNode(dto.t));\n\n        _te.appendChild(tl);\n      }\n\n      pe.appendChild(_te);\n    } // fill in empty space\n\n\n    d.setSeconds(0);\n    d.setMinutes(0);\n    d.setHours(1);\n    d.setTime(d.getTime() + 86400000); // lcc%=5\n    // if (lcc % 5 > 0) {\n    //     for (let ti, l = 5 - (lcc % 5), i = 0; i < l; i++) {\n    //\n    //         ti = d.getDay()\n    //\n    //         // Deal with weekends\n    //         if (pso[PPS_WEEKEND] === 0) {\n    //             // only show weekdays\n    //             ti = d.getDay()\n    //         } else {\n    //             // show all days\n    //             ti = 1\n    //         }\n    //\n    //         if (ti !== 0 && ti !== 6) {\n    //             lcd.appendChild(makeDateCont(d, true))\n    //         } else {\n    //             //skipping weekend\n    //             i--\n    //         }\n    //         d.setTime(d.getTime() + 86400000)\n    //     }\n    // }\n    // Make empty time cont\n\n    var te = document.createElement('div');\n    te.id = \"srgdev-dpu_tce\";\n    te.className = 'srgdev-dpu-time-cont';\n    te.appendChild(document.createTextNode(dpuTrNA));\n    lcTime.appendChild(te);\n    lcTime.firstElementChild.setAttribute('data-active', '');\n    lcd.curActive = an.toString();\n    cont.addEventListener(\"click\", timeClick);\n    document.getElementById('srgdev-ncfp_sel_cont').appendChild(cont); // let's make sure the correct date square is shown...\n    // ... 5 is the number of available slots per pagination page\n\n    var ti = Math.floor(an / 5);\n\n    if (ti > 0) {\n      lcdBF.curDP = ti;\n      prevNextDPU(lcdBF);\n    }\n  }\n})();"],"names":[],"sourceRoot":""}